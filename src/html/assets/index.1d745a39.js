var ne=Object.defineProperty,ie=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var V=(c,t,l)=>t in c?ne(c,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[t]=l,_=(c,t)=>{for(var l in t||(t={}))le.call(t,l)&&V(c,l,t[l]);if(Z)for(var l of Z(t))re.call(t,l)&&V(c,l,t[l]);return c},ee=(c,t)=>ie(c,oe(t));var C=(c,t,l)=>(V(c,typeof t!="symbol"?t+"":t,l),l);import{j as G,r as h,R as ce,a as ae}from"./vendor.277ef6c7.js";const ue=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function l(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function p(r){if(r.ep)return;r.ep=!0;const u=l(r);fetch(r.href,u)}};ue();let H=0,z=!1;const fe=()=>z=!1,he=()=>(console.log(H,"Adding 1 to n"),z||(H=H+1),z=!0,H);class J{constructor(t,l,p=!1,r=!1){C(this,"s");C(this,"p");C(this,"id");C(this,"isEllipse");C(this,"fillFlag");if(this.p=t[0],this.s=t[1],l)this.orient(),typeof l=="number"?this.id=l:this.id=-1;else{const u=he();this.id=u}this.isEllipse=p,this.fillFlag=r}orient(){this.s[0]<0&&(this.s[0]-=2*this.s[0],this.p[0]-=this.s[0]),this.s[1]<0&&(this.s[1]-=2*this.s[1],this.p[1]-=this.s[1])}draw(t){t.beginPath(),t.rect(this.p[0],this.p[1],this.s[0],this.s[1]),this.fillFlag&&t.fill(),t.stroke(),t.closePath()}move(t){this.p=[...t]}resize(t){this.s=[...t]}intersects(t){let l=this.p[0],p=this.p[1],r=this.s[0],u=this.s[1],f,y,x,v;return t instanceof J?(f=t.p[0],y=t.p[1],x=t.s[0],v=t.s[1]):(f=t[0][0],y=t[0][1],x=t[1][0],v=t[1][1]),!(l+r<f||f+x<l||p+u<y||y+v<p)}toString(){return`Rect#${this.id}: <${this.p[0]}, ${this.p[0]+this.s[0]}>,  <${this.p[1]}, ${this.p[1]+this.s[1]}> `}inside(t){return t[0]>this.p[0]&&t[0]<this.p[0]+this.s[0]&&t[1]>this.p[1]&&t[1]<this.p[1]+this.s[1]}getID(){return this.id}getRectData(){return[this.s,this.p]}}class B extends J{constructor(t,l,p,r=!1,u=!1){super(t,l,r,u);C(this,"clicked");this.clicked=p}draw(t,l,p,r,u){let f,y;const x=l===void 0?this.isEllipse:l;if(r?(f=`rgb(${r[0][0]},${r[0][1]},${r[0][2]})`,`${r[1][0]}${r[1][1]}${r[1][2]}`):f="green",p?y=`rgb(${p[0][0]},${p[0][1]},${p[0][2]})`:y="black",t.beginPath(),x?t.rect(this.p[0],this.p[1],this.s[0],this.s[1]):t.ellipse(this.p[0]+this.s[0]/2,this.p[1]+this.s[1]/2,this.s[0]/2,this.s[1]/2,0,0,2*Math.PI),t.strokeStyle=this.clicked?f:y,this.fillFlag&&(t.fillStyle="white",t.fill()),t.stroke(),this.clicked){const v=t.fillStyle;t.globalAlpha=.5,t.fillStyle=f,t.rect(this.p[0],this.p[1],this.s[0],this.s[1]),t.fill(),t.globalAlpha=1,t.fillStyle=v}if(this.id!=-1){t.fillStyle=this.clicked?f:y;const v=t.font;t.font="italic 900 10px sans-serif";const k=t.measureText(`Text${this.id}`);t.fillRect(this.p[0],this.p[1]-k.actualBoundingBoxAscent-10,k.width+10,k.actualBoundingBoxAscent+10),t.fillStyle="red",t.fillText(`Text${this.getID()}`,this.p[0]+5,this.p[1]-5),t.font=v}if(u&&x){let v=[];const k=()=>v.reduce((S,R,F)=>S+R.actualBoundingBoxAscent*1.2*(F?1:0)+5,0),g=t.font;u.split(`
`).forEach((S,R)=>{v.push(t.measureText(S));const F=this.p[0]+5,D=this.p[1]+k()+10,T=this.s[0]-10;t.strokeStyle="white",t.strokeText(S,F,D,T),t.fillStyle="black",t.fillText(S,F,D,T)}),t.font=g}t.closePath()}}const te=c=>{if(!(c.length!==3&&c.length!==6)&&(c.length===3&&(c=c.charAt(0).repeat(2)+c.charAt(1).repeat(2)+c.charAt(2).repeat(2)),c.length===6))return[parseInt(c.substring(0,2),16),parseInt(c.substring(2,4),16),parseInt(c.substring(4,6),16)]},m=G.exports.jsx,U=G.exports.jsxs,W=G.exports.Fragment,se=[0,255,0],de=({size:c,style:t,setDataID:l,offsetLeft:p,onkeydown:r,onkeyup:u,fillFlag:f,triggerDelete:y,getData:x,colors:v})=>{const k=h.exports.useRef(null),[g,S]=h.exports.useState([]),[R,F]=h.exports.useState(!1),[D,T]=h.exports.useState(new B([[0,0],[0,0]],!0,!1,f)),[$,I]=h.exports.useState([]),Y=()=>{const o=k.current,e=o==null?void 0:o.getContext("2d");e&&(e.beginPath(),e.clearRect(0,0,c[0],c[1]),g.forEach(s=>s.draw(e,void 0,void 0,[te("a2c5ac")||se,te("92b59c")||se],x(s.getID()))),R!==!1&&(D.draw(e),e.stroke())),e==null||e.restore()};h.exports.useEffect(()=>{y[0]&&M(),y[1]()},[y[0]]),h.exports.useEffect(()=>{Y()});const L=(o,e)=>{var s,n,i,a;return e?[o.clientX-(((n=(s=k.current)==null?void 0:s.getBoundingClientRect())==null?void 0:n.left)||0),o.clientY-(((a=(i=k.current)==null?void 0:i.getBoundingClientRect())==null?void 0:a.top)||0)]:[0,0]},j=o=>{const e=k.current;if(e){const[s,n]=L(o,e);if(o.button===0){R===!1&&F(g.length);const i=new B([[s,n],[0,0]],!0,!1,!o.altKey,f);T(a=>i)}else o.button===2&&(console.log(g),g.find(i=>i.inside([s,n])),o.preventDefault(),o.stopPropagation())}},E=o=>{const e=k.current;if(e){const[s,n]=L(o,e);o.button===0&&R!==!1&&T(i=>{const a=[s-i.p[0],n-i.p[1]];return new B([i.p,a],!0,!1,i.isEllipse,i.fillFlag)})}},M=()=>{if(g.length<=0)return;const o=$[$.length-2],e=$[$.length-1];if(I(s=>{const n=[...s];return n.pop(),n}),S(s=>{const n=[...s];return n.splice(n.findIndex(i=>i.getID()===e),1),n}),o){const s=g.find(n=>n.getID()===o);if(console.log("nc,n",o,s==null?void 0:s.getID()),s){const n=s.getID();N(n),P(n),l(n,(s||g[0]).getRectData())}else K()}else K();return e},b=()=>{if(g.length<=0)return;const o=$[$.length-1],e=g.find(n=>n.getID()===1+o);console.log(o,e==null?void 0:e.getID());let s=1;e&&(s=e.getID()),N(s),P(s),l(s,(e||g[0]).getRectData())},N=o=>{I(e=>{const s=[...e,o];return s.forEach(n=>{let i;for(;(i=s.filter(a=>a===n)).length>1;)s.splice(s.indexOf(i[0]),1)}),s})},P=o=>{S(e=>e.slice().map(s=>new B([s.p,s.s],s.id,s.getID()===o,s.isEllipse,s.fillFlag)))},K=()=>{I(o=>{const e=[...o];return e.sort(),e}),S(o=>o.slice().map(e=>new B([e.p,e.s],e.id,!1,e.isEllipse,e.fillFlag))),l(0,[[0,0],[0,0]])},X=o=>{const e=n=>{const[i,a]=[n.getRectData(),n.getID()];N(a),P(a),l(a,i)},s=k.current;if(s){const[n,i]=L(o,s),a=g.filter(d=>d.inside([n,i]));if(a.length===1){const d=a[0];d&&e(d)}else if(a.length>0){const d=a.reduce((w,O)=>$.indexOf(w.getID())<$.indexOf(O.getID())?w:O);d&&e(d)}else K();o.preventDefault(),o.stopPropagation()}},A=o=>{o.button===0&&(F(!1),D.s[0]*D.s[1]>50?(S(e=>[...e,new B([D.p,D.s],!1,!1,D.isEllipse,D.fillFlag)]),fe(),console.log("End Drag",D.toString())):X(o))};return console.log("Rects:",g),m(W,{children:m("canvas",{onKeyUp:o=>u(o,{nextRect:b,removeRect:M}),onKeyDown:o=>{console.log(o.key),r(o,{nextRect:b,removeRect:M})},tabIndex:0,style:ee(_({},t),{left:`${p}px`}),ref:k,width:c[0],height:c[1],onMouseDown:j,onMouseMove:E,onMouseUp:A,onContextMenu:o=>o.preventDefault()})})};function pe(){var o;const[c,t]=h.exports.useState(!1),[l,p]=h.exports.useState(""),[r,u]=h.exports.useState(""),[f,y]=h.exports.useState(),[x,v]=h.exports.useState(0);h.exports.useRef(null);const[k,g]=h.exports.useState(!1),[S,R]=h.exports.useState(""),[F,D]=h.exports.useState([0,0]),[T,$]=h.exports.useState(0),[I,Y]=h.exports.useState(0),[L,j]=h.exports.useState(new Map),[E,M]=h.exports.useState(!1),b=h.exports.useRef(null),N=(e,s,n)=>{const i=document.createElement("input");i.type="file",i.style.display="none",i.accept=e,i.multiple=s,i.onchange=()=>{n(i.files)},i.click()},P=e=>{j(s=>{const n=[...s];return n.splice(n.findIndex(i=>i[0]===e),1),new Map(n)})},K=[{text:"File",onclick:e=>{},sub:[{text:"Load IMG(s)",onclick:e=>{N(".jpg,.png,.bmp",!1,s=>{s&&[...s].forEach(async n=>{const a=await n.slice().arrayBuffer(),d=btoa(new Uint8Array(a).reduce((w,O)=>w+String.fromCharCode(O),""));u(n.type),p(d),t(!0),R(`Loaded file: ${n.name}`)})})}},{text:"Load .TLF",onclick:()=>{const e=document.createElement("input");e.type="file"}},{text:"Load .xTLF",onclick:()=>{}}]},{text:"Save",onclick:e=>{},sub:[{text:"As .TLF",onclick:()=>{const e=[...L];let s="",n="";e.forEach(w=>{const O=w[1][0],q=w[0],Q=w[1][1];q&&(s+=`${q}:${O}
`,n+=`${q}{${Q[0]}/${Q[1]}};`)});const i=`${s}

${n}`,a=new Blob([i],{type:"text/plain"}),d=document.createElement("a");d.href=URL.createObjectURL(a),d.setAttribute("download","file.TLF"),d.click(),URL.revokeObjectURL(d.href)}},{text:"As .xTLF",onclick:e=>{}}]},{text:"Options",onclick:e=>{},sub:[{text:`${E?"[V]":""} Fill (Alt+F)`,onclick:e=>{M(!E)}},{text:"Delete (Alt + Delete)",onclick:e=>{g(!0)}}]},{text:"Instructions",onclick:e=>{}},{text:`${S}`,onclick:e=>{},customCSS:["no-back no-hover allow-copy"]}],X=(e,s)=>{var i,a,d;const n=`${s}_${e.text}`;return e.text?U("li",{className:((i=e.customCSS)==null?void 0:i[0])||"",onClick:e.onclick,children:[m("span",{className:((a=e.customCSS)==null?void 0:a[1])||"",children:e.text},`s${n}`),e.sub&&m("ul",{className:`${s} ${((d=e.customCSS)==null?void 0:d[2])||""}`,children:e.sub.map(w=>X(w,"micro"))},`sub_${n}`)]},n):m(W,{})},A=(e,s)=>{I&&(j(n=>{const i=[...n],a=i[i.length-1],d=s||a[1][1];return new Map([...n,[I,[e,d]]])}),b.current&&(b.current.style.height="auto",b.current.style.height=`${b.current.scrollHeight}px`))};return document.onkeydown=e=>{(e.key==="Tab"||e.key===" ")&&e.preventDefault()},U("div",{children:[m("nav",{className:"menu",children:m("ul",{children:K.map(e=>X(e,"sub-menu"))},"main")}),c&&m(W,{children:U("main",{children:[U("div",{className:"draw",children:[m("div",{className:"under",children:m("img",{src:`data:${r};base64,${l}`,alt:"Sorry corrupted file",onLoad:e=>{D([e.currentTarget.naturalWidth,e.currentTarget.naturalHeight]),$(e.currentTarget.offsetLeft)}})}),m(de,{triggerDelete:[k,()=>g(!1)],fillFlag:E,getData:e=>{var s;return((s=[...L].find(n=>n[0]===e))==null?void 0:s[1][0])||""},onkeydown:(e,s)=>{const n=()=>{var a;v(x+1);const i=(a=b.current)==null?void 0:a.value;i&&A(e.shiftKey?i.substring(0,i.lastIndexOf(" ")):i.substring(0,i.length-(x+1)))};if(console.log("okd",e.key,e.altKey),e.key==="Delete"&&e.altKey){const i=s.removeRect();i&&P(i)}else(e.key==="Backspace"||e.key==="Delete")&&(n(),f||y(setInterval(n,100)))},onkeyup:(e,s)=>{var n;if(e.key==="Tab")s.nextRect();else if(e.key==="c"&&e.ctrlKey){const i=(n=L.get(I))==null?void 0:n[0];i&&navigator.clipboard.writeText(i),R("Copied to clipboard!")}else e.key.length===1&&!e.altKey?b.current&&!b.current.disabled&&(b.current.value+=e.key,A(b.current.value)):e.key==="f"&&e.altKey?(M(!E),console.log("alt + f")):(e.key==="Backspace"||e.key==="Delete")&&f&&(clearInterval(f),y(0),v(0));e.key==="Enter"&&b.current&&A(b.current.value+`
`)},setDataID:(e,s)=>{Y(e),j(n=>n.has(e)||!n?n:new Map([...n,[e,["",s]]]))},size:F,offsetLeft:T})]}),m("div",{children:U("div",{id:"text",children:[m("span",{children:I?`Text #${I}`:"Select text to describe"}),m("textarea",{name:"text",id:"text",ref:b,placeholder:"Type here",onInput:e=>{e.currentTarget.style.height="auto",e.currentTarget.style.height=`${e.currentTarget.scrollHeight}px`},onChange:e=>{A(e.currentTarget.value||"")},onFocus:()=>{var e;return(e=document.querySelector("canvas"))==null?void 0:e.focus()},disabled:!I,value:((o=L.get(I))==null?void 0:o[0])||""})]})})]})})]})}ce.render(m(ae.StrictMode,{children:m(pe,{})}),document.getElementById("root"));
