var se=Object.defineProperty,ne=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var V=(c,t,o)=>t in c?se(c,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[t]=o,Z=(c,t)=>{for(var o in t||(t={}))le.call(t,o)&&V(c,o,t[o]);if(Q)for(var o of Q(t))oe.call(t,o)&&V(c,o,t[o]);return c},_=(c,t)=>ne(c,ie(t));var T=(c,t,o)=>(V(c,typeof t!="symbol"?t+"":t,o),o);import{j as G,r as h,R as re,a as ce}from"./vendor.277ef6c7.js";const ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))d(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&d(f)}).observe(document,{childList:!0,subtree:!0});function o(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function d(r){if(r.ep)return;r.ep=!0;const u=o(r);fetch(r.href,u)}};ae();const H=class{constructor(t,o,d=!1,r=!1){T(this,"s");T(this,"p");T(this,"id");T(this,"isEllipse");T(this,"fillFlag");this.p=t[0],this.s=t[1],o&&this.orient(),this.id=o===!0?H.n++:typeof o=="number"?o:-1,this.isEllipse=d,this.fillFlag=r}orient(){this.s[0]<0&&(this.s[0]-=2*this.s[0],this.p[0]-=this.s[0]),this.s[1]<0&&(this.s[1]-=2*this.s[1],this.p[1]-=this.s[1])}draw(t){t.beginPath(),t.rect(this.p[0],this.p[1],this.s[0],this.s[1]),this.fillFlag&&t.fill(),t.stroke(),t.closePath()}move(t){this.p=[...t]}resize(t){this.s=[...t]}intersects(t){let o=this.p[0],d=this.p[1],r=this.s[0],u=this.s[1],f,y,S,m;return t instanceof H?(f=t.p[0],y=t.p[1],S=t.s[0],m=t.s[1]):(f=t[0][0],y=t[0][1],S=t[1][0],m=t[1][1]),!(o+r<f||f+S<o||d+u<y||y+m<d)}toString(){return`Rect#${this.id}: <${this.p[0]}, ${this.p[0]+this.s[0]}>,  <${this.p[1]}, ${this.p[1]+this.s[1]}> `}inside(t){return t[0]>this.p[0]&&t[0]<this.p[0]+this.s[0]&&t[1]>this.p[1]&&t[1]<this.p[1]+this.s[1]}getID(){return(this.id-1)/2+1}getRectData(){return[this.s,this.p]}};let z=H;T(z,"n",0);class B extends z{constructor(t,o,d,r=!1,u=!1){super(t,o,r,u);T(this,"clicked");this.clicked=d}draw(t,o,d,r,u){let f,y;const S=o===void 0?this.isEllipse:o;if(r?(f=`rgb(${r[0][0]},${r[0][1]},${r[0][2]})`,`${r[1][0]}${r[1][1]}${r[1][2]}`):f="green",d?y=`rgb(${d[0][0]},${d[0][1]},${d[0][2]})`:y="black",t.beginPath(),S?t.rect(this.p[0],this.p[1],this.s[0],this.s[1]):t.ellipse(this.p[0]+this.s[0]/2,this.p[1]+this.s[1]/2,this.s[0]/2,this.s[1]/2,0,0,2*Math.PI),t.strokeStyle=this.clicked?f:y,this.fillFlag&&(t.fillStyle="white",t.fill()),t.stroke(),this.clicked){const m=t.fillStyle;t.globalAlpha=.5,t.fillStyle=f,t.rect(this.p[0],this.p[1],this.s[0],this.s[1]),t.fill(),t.globalAlpha=1,t.fillStyle=m}if(this.id!=-1){t.fillStyle=this.clicked?f:y;const m=t.measureText(`Text${this.id}`);t.fillRect(this.p[0],this.p[1]-m.actualBoundingBoxAscent-10,m.width+10,m.actualBoundingBoxAscent+10),t.fillStyle="red",t.fillText(`Text${this.getID()}`,this.p[0]+5,this.p[1]-5)}if(u&&S){let m=[];const x=()=>m.reduce((D,R,F)=>D+R.actualBoundingBoxAscent*1.2*(F?1:0)+5,0),g=t.font;u.split(`
`).forEach((D,R)=>{m.push(t.measureText(D)),t.font="14px Arial";const F=this.p[0]+5,v=this.p[1]+x()+10,C=this.s[0]-10;t.strokeStyle="white",t.strokeText(D,F,v,C),t.fillStyle="black",t.fillText(D,F,v,C)}),t.font=g}t.closePath()}}const ee=c=>{if(!(c.length!==3&&c.length!==6)&&(c.length===3&&(c=c.charAt(0).repeat(2)+c.charAt(1).repeat(2)+c.charAt(2).repeat(2)),c.length===6))return[parseInt(c.substring(0,2),16),parseInt(c.substring(2,4),16),parseInt(c.substring(4,6),16)]},k=G.exports.jsx,U=G.exports.jsxs,W=G.exports.Fragment,te=[0,255,0],ue=({size:c,style:t,setDataID:o,offsetLeft:d,onkeydown:r,onkeyup:u,fillFlag:f,triggerDelete:y,getData:S,colors:m})=>{const x=h.exports.useRef(null),[g,D]=h.exports.useState([]),[R,F]=h.exports.useState(!1),[v,C]=h.exports.useState(new B([[0,0],[0,0]],!1,!1,f)),[$,I]=h.exports.useState([]),Y=()=>{const l=x.current,e=l==null?void 0:l.getContext("2d");e&&(e.beginPath(),e.clearRect(0,0,c[0],c[1]),g.forEach(s=>s.draw(e,void 0,void 0,[ee("a2c5ac")||te,ee("92b59c")||te],S(s.getID()))),R!==!1&&(v.draw(e),e.stroke())),e==null||e.restore()};h.exports.useEffect(()=>{y[0]&&M(),y[1]()},[y[0]]),h.exports.useEffect(()=>{Y()});const L=(l,e)=>{var s,n,i,a;return e?[l.clientX-(((n=(s=x.current)==null?void 0:s.getBoundingClientRect())==null?void 0:n.left)||0),l.clientY-(((a=(i=x.current)==null?void 0:i.getBoundingClientRect())==null?void 0:a.top)||0)]:[0,0]},j=l=>{const e=x.current;if(e){const[s,n]=L(l,e);if(l.button===0){R===!1&&F(g.length);const i=new B([[s,n],[0,0]],!1,!1,!l.altKey,f);C(a=>i)}else l.button===2&&(console.log(g),g.find(i=>i.inside([s,n])),l.preventDefault(),l.stopPropagation())}},E=l=>{const e=x.current;if(e){const[s,n]=L(l,e);l.button===0&&R!==!1&&C(i=>{const a=[s-i.p[0],n-i.p[1]];return new B([i.p,a],!1,!1,i.isEllipse,i.fillFlag)})}},M=()=>{if(g.length<=0)return;const l=$[$.length-2],e=$[$.length-1];if(I(s=>{const n=[...s];return n.pop(),n}),D(s=>{const n=[...s];return n.splice(n.findIndex(i=>i.getID()===e),1),n}),l){const s=g.find(n=>n.getID()===l);if(console.log("nc,n",l,s==null?void 0:s.getID()),s){const n=s.getID();P(n),K(n),o(n,(s||g[0]).getRectData())}else N()}else N();return e},b=()=>{if(g.length<=0)return;const l=$[$.length-1],e=g.find(n=>n.getID()===1+l);console.log(l,e==null?void 0:e.getID());let s=1;e&&(s=e.getID()),P(s),K(s),o(s,(e||g[0]).getRectData())},P=l=>{I(e=>{const s=[...e,l];return s.forEach(n=>{let i;for(;(i=s.filter(a=>a===n)).length>1;)s.splice(s.indexOf(i[0]),1)}),s})},K=l=>{D(e=>e.slice().map(s=>new B([s.p,s.s],s.id,s.getID()===l,s.isEllipse,s.fillFlag)))},N=()=>{I(l=>{const e=[...l];return e.sort(),e}),D(l=>l.slice().map(e=>new B([e.p,e.s],e.id,!1,e.isEllipse,e.fillFlag))),o(0,[[0,0],[0,0]])},X=l=>{const e=n=>{const[i,a]=[n.getRectData(),n.getID()];P(a),K(a),o(a,i)},s=x.current;if(s){const[n,i]=L(l,s),a=g.filter(p=>p.inside([n,i]));if(a.length===1){const p=a[0];p&&e(p)}else if(a.length>0){const p=a.reduce((w,O)=>$.indexOf(w.getID())<$.indexOf(O.getID())?w:O);p&&e(p)}else N();l.preventDefault(),l.stopPropagation()}},A=l=>{l.button===0&&(F(!1),v.s[0]*v.s[1]>50?(D(e=>[...e,new B([v.p,v.s],!0,!1,v.isEllipse,v.fillFlag)]),console.log("End Drag",v.toString())):X(l))};return console.log("Rects:",g),k(W,{children:k("canvas",{onKeyUp:l=>u(l,{nextRect:b,removeRect:M}),onKeyDown:l=>{console.log(l.key),r(l,{nextRect:b,removeRect:M})},tabIndex:0,style:_(Z({},t),{left:`${d}px`}),ref:x,width:c[0],height:c[1],onMouseDown:j,onMouseMove:E,onMouseUp:A,onContextMenu:l=>l.preventDefault()})})};function fe(){var l;const[c,t]=h.exports.useState(!1),[o,d]=h.exports.useState(""),[r,u]=h.exports.useState(""),[f,y]=h.exports.useState(),[S,m]=h.exports.useState(0);h.exports.useRef(null);const[x,g]=h.exports.useState(!1),[D,R]=h.exports.useState(""),[F,v]=h.exports.useState([0,0]),[C,$]=h.exports.useState(0),[I,Y]=h.exports.useState(0),[L,j]=h.exports.useState(new Map),[E,M]=h.exports.useState(!1),b=h.exports.useRef(null),P=(e,s,n)=>{const i=document.createElement("input");i.type="file",i.style.display="none",i.accept=e,i.multiple=s,i.onchange=()=>{n(i.files)},i.click()},K=e=>{j(s=>{const n=[...s];return n.splice(n.findIndex(i=>i[0]===e),1),new Map(n)})},N=[{text:"File",onclick:e=>{},sub:[{text:"Load IMG(s)",onclick:e=>{P(".jpg,.png,.bmp",!1,s=>{s&&[...s].forEach(async n=>{const a=await n.slice().arrayBuffer(),p=btoa(new Uint8Array(a).reduce((w,O)=>w+String.fromCharCode(O),""));u(n.type),d(p),t(!0),R(`Loaded file: ${n.name}`)})})}},{text:"Load .TLF",onclick:()=>{const e=document.createElement("input");e.type="file"}},{text:"Load .xTLF",onclick:()=>{}}]},{text:"Save",onclick:e=>{},sub:[{text:"As .TLF",onclick:()=>{const e=[...L];let s="",n="";e.forEach(w=>{const O=w[1][0],q=w[0],J=w[1][1];q&&(s+=`${q}:${O}
`,n+=`${q}{${J[0]}/${J[1]}};`)});const i=`${s}

${n}`,a=new Blob([i],{type:"text/plain"}),p=document.createElement("a");p.href=URL.createObjectURL(a),p.setAttribute("download","file.TLF"),p.click(),URL.revokeObjectURL(p.href)}},{text:"As .xTLF",onclick:e=>{}}]},{text:"Options",onclick:e=>{},sub:[{text:`${E?"[V]":""} Fill (Alt+F)`,onclick:e=>{M(!E)}},{text:"Delete (Alt + Delete)",onclick:e=>{g(!0)}}]},{text:"Instructions",onclick:e=>{}},{text:`${D}`,onclick:e=>{},customCSS:["no-back no-hover allow-copy"]}],X=(e,s)=>{var i,a,p;const n=`${s}_${e.text}`;return e.text?U("li",{className:((i=e.customCSS)==null?void 0:i[0])||"",onClick:e.onclick,children:[k("span",{className:((a=e.customCSS)==null?void 0:a[1])||"",children:e.text},`s${n}`),e.sub&&k("ul",{className:`${s} ${((p=e.customCSS)==null?void 0:p[2])||""}`,children:e.sub.map(w=>X(w,"micro"))},`sub_${n}`)]},n):k(W,{})},A=(e,s)=>{I&&(j(n=>{const i=[...n],a=i[i.length-1],p=s||a[1][1];return new Map([...n,[I,[e,p]]])}),b.current&&(b.current.style.height="auto",b.current.style.height=`${b.current.scrollHeight}px`))};return document.onkeydown=e=>{(e.key==="Tab"||e.key===" ")&&e.preventDefault()},U("div",{children:[k("nav",{className:"menu",children:k("ul",{children:N.map(e=>X(e,"sub-menu"))},"main")}),c&&k(W,{children:U("main",{children:[U("div",{className:"draw",children:[k("div",{className:"under",children:k("img",{src:`data:${r};base64,${o}`,alt:"Sorry corrupted file",onLoad:e=>{v([e.currentTarget.naturalWidth,e.currentTarget.naturalHeight]),$(e.currentTarget.offsetLeft)}})}),k(ue,{triggerDelete:[x,()=>g(!1)],fillFlag:E,getData:e=>{var s;return((s=[...L].find(n=>n[0]===e))==null?void 0:s[1][0])||""},onkeydown:(e,s)=>{const n=()=>{var a;m(S+1);const i=(a=b.current)==null?void 0:a.value;i&&A(e.shiftKey?i.substring(0,i.lastIndexOf(" ")):i.substring(0,i.length-(S+1)))};if(console.log("okd",e.key,e.altKey),e.key==="Delete"&&e.altKey){const i=s.removeRect();i&&K(i)}else(e.key==="Backspace"||e.key==="Delete")&&(n(),f||y(setInterval(n,100)))},onkeyup:(e,s)=>{var n;if(e.key==="Tab")s.nextRect();else if(e.key==="c"&&e.ctrlKey){const i=(n=L.get(I))==null?void 0:n[0];i&&navigator.clipboard.writeText(i),R("Copied to clipboard!")}else e.key.length===1&&!e.altKey?b.current&&!b.current.disabled&&(b.current.value+=e.key,A(b.current.value)):e.key==="f"&&e.altKey?(M(!E),console.log("alt + f")):(e.key==="Backspace"||e.key==="Delete")&&f&&(clearInterval(f),y(0),m(0));e.key==="Enter"&&b.current&&A(b.current.value+`
`)},setDataID:(e,s)=>{Y(e),j(n=>n.has(e)||!n?n:new Map([...n,[e,["",s]]]))},size:F,offsetLeft:C})]}),k("div",{children:U("div",{id:"text",children:[k("span",{children:I?`Text #${I}`:"Select text to describe"}),k("textarea",{name:"text",id:"text",ref:b,placeholder:"Type here",onInput:e=>{e.currentTarget.style.height="auto",e.currentTarget.style.height=`${e.currentTarget.scrollHeight}px`},onChange:e=>{A(e.currentTarget.value||"")},onFocus:()=>{var e;return(e=document.querySelector("canvas"))==null?void 0:e.focus()},disabled:!I,value:((l=L.get(I))==null?void 0:l[0])||""})]})})]})})]})}re.render(k(ce.StrictMode,{children:k(fe,{})}),document.getElementById("root"));
